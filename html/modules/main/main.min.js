/*
 * FOstatus by Rotators
 * https://github.com/rotators/fodev-status/
 *
 * @preserve
 */
function start(){$("#games").hide(),$("#footer").hide(),fo.ConfigURL=configFile,update(!0),$("#show_offline").click(function(){$("#server_status.offline").toggle()}),$("#show_closed").click(function(){$("#server_status.closed").toggle()}),$("#show_singleplayer").click(function(){$("#server_status.singleplayer").toggle()}),$("#games").show(),$("#footer").show(),setInterval(update,6e4)}function update(e){if(fo.defaultArgument(e,!1),e||$("#auto_update").prop("checked")){ShowInfo((e?"Load":"Updat")+"ing...");var s=$("#show_offline").prop("checked"),r=$("#show_closed").prop("checked"),l=$("#show_singleplayer").prop("checked");fo.LoadJSONQueue(!0,dataDir,["status","average_short"],function(e){var a=e.status,t=e.average_short;if(e=null,null==a.servers||null==a.players||null==a.server)return void ShowInfo("Invalid status data");var n=[];$.each(fo.GetServersArray("name"),function(e,i){var o=!1,d=!1,u=!1;null!=i.singleplayer&&i.singleplayer?u=!0:null!=i.closed&&i.closed?d=!0:null!=a.server[i.id]&&a.server[i.id].uptime>=0&&(o=!0);var p=$("<div/>",{id:"server_status","class":i.id}),c=$("<pre/>",{"class":"stats"}),h=$("<address/>",{"class":"links"}),v=i.name+"<br>";if(o){p.addClass("online"),v+=a.server[i.id].players>0?"Players: "+a.server[i.id].players:"No players",null!=t&&null!=t.server[i.id]&&(v+=" (average: "+t.server[i.id]+")"),v+="<br>Uptime: ";var f=[],g=fo.ExtractSeconds(a.server[i.id].uptime);$.each(["year","month","week","day","hour","minute"],function(e,s){return g[e]>0&&(f.push(g[e]+" "+s+(g[e]>1?"s":"")),f.length>=2)?!1:void 0}),f.length>0&&(v+=f.join(" and "))}else if(u?(v+="Singleplayer",p.addClass("singleplayer"),l||p.hide()):d?(v+="Closed",p.addClass("closed"),r||p.hide()):(v+="Offline",p.addClass("offline"),s||p.hide()),!u&&(null!=t&&null!=t.server[i.id]&&(v+=" (average players: "+t.server[i.id]+")"),!d))if(null!=a.server[i.id]&&null!=a.server[i.id].seen&&a.server[i.id].seen>0){v+="<br>Last seen: ";var y=new Date(1e3*a.server[i.id].seen),_=new Date,m=["January","February","March","April","May","June","July","August","September","October","November","December"];v+=_.getFullYear()==y.getFullYear()&&_.getMonth()==y.getMonth()&&_.getDate()==y.getDate()?"Today":y.getDate()+" "+m[y.getMonth()]+" "+y.getFullYear()}else p.addClass("not_seen");null!=v&&c.append(v),v=[],$.inArray("Server",siteModules)>=0&&null!=t&&null!=t.server[i.id]&&v.push("<a href='server/"+i.id+"/' title='Details'>Details</a>"),$.each(["Website","Link"],function(e,s){return null!=i[s.toLowerCase()]?(v.push("<a href='"+i[s.toLowerCase()]+"'>"+s+"</a>"),!1):void 0}),null!=i.source&&v.push("<a href='"+i.source+"'>Source</a>"),null!=i.irc&&"#"==i.irc.charAt(0)&&v.push("<a href='https://chat.forestnet.org/?channels="+i.irc+"' title='"+i.irc+" @ ForestNet'>IRC</a>"),v.length>0&&h.append("&#171; "+v.join(" &#183; ")+" &#187;"),p.append([c,h]),n.push(p)}),$("#games_list").empty(),n.length>0&&$("#games_list").append(n),$("#online_servers").text(a.servers),$("#online_players").text(a.players),1!=a.servers?$("#online_servers_s").text("s"):$("#online_servers_s").empty(),1!=a.players?$("#online_players_s").text("s"):$("#online_players_s").empty(),HideInfo()})}}