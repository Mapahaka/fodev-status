function start(){$("#games").hide();$("#footer").hide();fo.ConfigURL=configFile;$("#auto_update").prop("checked",localStorage.getItem("auto_update")==1);$("#show_offline").prop("checked",localStorage.getItem("show_offline")==1);$("#show_closed").prop("checked",localStorage.getItem("show_closed")==1);$("#show_singleplayer").prop("checked",localStorage.getItem("show_singleplayer")==1);$("#display_table").prop("checked",localStorage.getItem("display_table")==1);update(true,true);$("#auto_update").change(function(){localStorage.setItem("auto_update",$("#auto_update").prop("checked")?"1":"0")});$("#show_offline").change(function(){update(false,true);localStorage.setItem("show_offline",$("#show_offline").prop("checked")?"1":"0")});$("#display_table").change(function(){update(false,true);localStorage.setItem("display_table",$("#display_table").prop("checked")?"1":"0")});$("#show_closed").change(function(){update(false,true);localStorage.setItem("show_closed",$("#show_closed").prop("checked")?"1":"0")});$("#show_singleplayer").change(function(){update(false,true);localStorage.setItem("show_singleplayer",$("#show_singleplayer").prop("checked")?"1":"0")});$("#games").show();$("#footer").show();setInterval(function(){update(false,false)},6e4)}function renderGames(status,average){var show_offline=$("#show_offline").prop("checked");var show_closed=$("#show_closed").prop("checked");var show_singleplayer=$("#show_singleplayer").prop("checked");var show_table=$("#display_table").prop("checked");var divs=[];if(!show_table){$.each(fo.GetServersArray("name"),function(idx,server){var online=false,closed=false,singleplayer=false;if(server.singleplayer!=null&&server.singleplayer)singleplayer=true;else if(server.closed!=null&&server.closed)closed=true;else if(status.server[server.id]!=null&&status.server[server.id].uptime>=0)online=true;var div=$("<div/>",{id:"server_status",class:server.id});var stats=$("<pre/>",{class:"stats"});var links=$("<address/>",{class:"links"});var content=server.name+"<br>";if(online){div.addClass("online");if(status.server[server.id].players>0)content+="Players: "+status.server[server.id].players;else content+="No players";if(average!=null&&average.server[server.id]!=null)content+=" (average: "+average.server[server.id]+")";content+="<br>Uptime: ";var result=[];var uptime=fo.ExtractSeconds(status.server[server.id].uptime);$.each(["year","month","week","day","hour","minute"],function(idx,name){if(uptime[idx]>0){result.push(uptime[idx]+" "+name+(uptime[idx]>1?"s":""));if(result.length>=2)return false}});if(result.length>0)content+=result.join(" and ")}else{if(singleplayer){content+="Singleplayer";div.addClass("singleplayer");if(!show_singleplayer)div.hide()}else if(closed){content+="Closed";div.addClass("closed");if(!show_closed)div.hide()}else{content+="Offline";div.addClass("offline");if(!show_offline)div.hide()}if(!singleplayer){if(average!=null&&average.server[server.id]!=null)content+=" (average players: "+average.server[server.id]+")";if(!closed){if(status.server[server.id]!=null&&status.server[server.id].seen!=null&&status.server[server.id].seen>0){content+="<br>Last seen: ";var seen=new Date(status.server[server.id].seen*1e3);var now=new Date;var months=["January","February","March","April","May","June","July","August","September","October","November","December"];if(now.getFullYear()==seen.getFullYear()&&now.getMonth()==seen.getMonth()&&now.getDate()==seen.getDate())content+="Today";else content+=seen.getDate()+" "+months[seen.getMonth()]+" "+seen.getFullYear()}else div.addClass("not_seen")}}}if(content!=null)stats.append(content);content=[];if($.inArray("Server",siteModules)>=0&&average!=null&&average.server[server.id]!=null)content.push("<a href='server/"+server.id+"/' title='Game details'>Details</a>");$.each(["Website","Link"],function(idx,weblink){if(server[weblink.toLowerCase()]!=null){content.push("<a href='"+server[weblink.toLowerCase()]+"'>"+weblink+"</a>");return false}});if(server.source!=null)content.push("<a href='"+server.source+"'>Source</a>");if(server.discord!=null&&content.length!=3)content.push("<a href='https://discord.gg/"+server.discord+"'>Discord</a>");if(content.length>0)links.append("&#171; "+content.join(" &#183; ")+" &#187;");div.append([stats,links]);divs.push(div)});$("#games_list").empty();if(divs.length>0)$("#games_list").append(divs)}else{var rows="";$.each(fo.GetServersArray("name"),function(idx,server){var online=false,closed=false,singleplayer=false;if(server.singleplayer!=null&&server.singleplayer)singleplayer=true;else if(server.closed!=null&&server.closed)closed=true;else if(status.server[server.id]!=null&&status.server[server.id].uptime>=0)online=true;if(singleplayer&&!show_singleplayer)return;if(closed&&!show_closed)return;if(!online&&!singleplayer&&!closed&&!show_offline)return;var download="";var yt="";var twitter="";var discord="";if(server.download!=null){download='<a href="'+server.download+'" style="display: table-cell; width: 24px;"><img src="gfx/download-cloud.png" style="float: right;" title="Download" /></a>'}if(server.youtube!=null){yt='<a href="https://www.youtube.com/channel/'+server.youtube+'" style="display: table-cell; width: 24px;"><img src="gfx/film-youtube.png" style="float: right; " title="YouTube" /></a>'}if(server.twitter!=null){twitter='<a href="https://twitter.com/'+server.twitter+'" style="display: table-cell; width: 24px;"><img src="gfx/balloon-twitter-left.png" style="float: right; " title="Twitter" /></a>'}if(server.discord!=null){discord='<a href="https://discord.gg/'+server.discord+'" style="display: table-cell; width: 24px;"><img src="gfx/discord.png" style="float: right; " title="Discord" /></a>'}var cells="";cells+='<td><div style="display: table; width: 100%;"><a href="server/'+server.id+'/" title="Details" style="display: table-cell; vertical-align: middle; padding-right: 8px; white-space: nowrap;">'+server.name+"</a>"+yt+twitter+discord+download+"</div></td>";if(!singleplayer&&server.host!=undefined){cells+='<td style="white-space: nowrap; padding-right: 5px;">'+server.host+":"+server.port+"</td>"}else{cells+="<td></td>"}if(online){var s="";if(status.server[server.id].players>0)s+="Players: "+status.server[server.id].players;else s+="No players";if(average!=null&&average.server[server.id]!=null)s+=" (average: "+average.server[server.id]+")";s+="<br>Uptime: ";var result=[];var uptime=fo.ExtractSeconds(status.server[server.id].uptime);$.each(["year","month","week","day","hour","minute"],function(idx,name){if(uptime[idx]>0){result.push(uptime[idx]+" "+name+(uptime[idx]>1?"s":""));if(result.length>=2)return false}});if(result.length>0)s+=result.join(" and ");cells+="<td>"+s+"</td>"}else{if(closed){cells+="<td>Closed</td>"}else if(!closed&&!singleplayer){var s="Offline";if(status.server[server.id]!=null&&status.server[server.id].seen!=null&&status.server[server.id].seen>0){s+="<br>Last seen: ";var seen=new Date(status.server[server.id].seen*1e3);var now=new Date;var months=["January","February","March","April","May","June","July","August","September","October","November","December"];if(now.getFullYear()==seen.getFullYear()&&now.getMonth()==seen.getMonth()&&now.getDate()==seen.getDate())s+="Today";else s+=seen.getDate()+" "+months[seen.getMonth()]+" "+seen.getFullYear()}cells+='<td style="white-space: nowrap; padding-right: 5px;">'+s+"</td>"}else{cells+="<td>Singleplayer game</td>"}}var links=[];$.each(["Website","Link"],function(idx,weblink){if(server[weblink.toLowerCase()]!=null){links.push("<a href='"+server[weblink.toLowerCase()]+"'>"+weblink+"</a>");return false}});if(server.source!=null)links.push("<a href='"+server.source+"'>Code</a>");if(server.discord!=null)links.push("<a href='https://discord.gg/"+server.discord+"'>Discord</a>");cells+='<td style="white-space: nowrap; padding-right: 5px;">'+links.join(" &#183; ")+"</td>";if(online){rows+='<tr class="online">'+cells+"</tr>"}else if(!singleplayer){rows+='<tr class="offline">'+cells+"</tr>"}else{rows+='<tr class="single">'+cells+"</tr>"}});var cols="";cols+="<th>Game</th><th>Server</th><th>Status</th><th>Links</th>";$("#games_list").html('<table id="game_table" style="font-size: 10px;"><thead><tr>'+cols+"</tr></thead><tbody>"+rows+"</tbody></table>")}}function update(first_time,force){fo.defaultArgument(first_time,false);if(!first_time&&!$("#auto_update").prop("checked")&&!force)return;ShowInfo((first_time?"Load":"Updat")+"ing...");fo.LoadJSONQueue(true,dataDir,["status","average_short"],function(result){var status=result.status;var average=result.average_short;result=null;if(status.servers==null||status.players==null||status.server==null){ShowInfo("Invalid status data");return}renderGames(status,average);$("#online_servers").text(status.servers);$("#online_players").text(status.players);if(status.servers!=1)$("#online_servers_s").text("s");else $("#online_servers_s").empty();if(status.players!=1)$("#online_players_s").text("s");else $("#online_players_s").empty();HideInfo()})}
